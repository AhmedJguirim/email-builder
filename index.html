<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MailBuilder - Visual Email Builder</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath d='M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z'/%3E%3C/svg%3E">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    }
    
    #app {
      height: 100%;
    }
    
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      background: #f5f5f5;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #e5e7eb;
      border-top-color: #3b82f6;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="loading">
      <div class="loading-spinner"></div>
    </div>
  </div>
  
  <script type="module">
    import { createMailBuilder } from './src/index.ts';
    
    // Load initial blocks from JSON file
    async function loadInitialBlocks() {
      try {
        const response = await fetch('/initial-blocks.json');
        if (!response.ok) {
          console.warn('Could not load initial blocks, using empty array');
          return [];
        }
        return await response.json();
      } catch (error) {
        console.warn('Error loading initial blocks:', error);
        return [];
      }
    }

    // Initialize the email builder
    async function initBuilder() {
      const initialBlocks = await loadInitialBlocks();
      
      const builder = createMailBuilder({
        container: '#app',
        initialBlocks: initialBlocks,
        initialStyles: {
          body: {
            backgroundColor: '#f4f4f4',
            fontFamily: 'Arial, Helvetica, sans-serif',
            fontSize: '16px',
            lineHeight: '1.5',
            color: '#333333',
            margin: '0',
            padding: '0',
          },
          container: {
            backgroundColor: '#ffffff',
            maxWidth: '600px',
            borderRadius: '0',
            padding: '0',
            borderWidth: '0',
            borderColor: '#e5e7eb',
            borderStyle: 'solid',
          },
          link: {
            color: '#3b82f6',
            textDecoration: 'underline',
            hoverColor: '#2563eb',
          },
          heading: {
            fontFamily: 'Arial, Helvetica, sans-serif',
            color: '#111827',
            fontWeight: '700',
          },
        },
        variables: [
          { id: 'var_1', name: 'First Name', key: 'first_name', defaultValue: 'Subscriber' },
          { id: 'var_2', name: 'Last Name', key: 'last_name', defaultValue: '' },
          { id: 'var_3', name: 'Email', key: 'email', defaultValue: '' },
          { id: 'var_4', name: 'Company Name', key: 'company_name', defaultValue: 'Your Company' },
          { id: 'var_5', name: 'Company Address', key: 'company_address', defaultValue: '123 Main St, City, Country' },
          { id: 'var_6', name: 'Unsubscribe Link', key: 'unsubscribe_link', defaultValue: '#unsubscribe' },
          { id: 'var_7', name: 'View in Browser', key: 'view_in_browser_link', defaultValue: '#' },
          { id: 'var_8', name: 'Current Year', key: 'current_year', defaultValue: new Date().getFullYear().toString() },
        ],
        autosave: false,
        onBlockSelect: (block) => {
          console.log('Selected block:', block);
        },
        onBlockChange: (blocks) => {
          console.log('Blocks updated:', blocks.length, 'blocks');
        },
        onSave: (data) => {
          console.log('Email saved:', data);
          localStorage.setItem('mailbuilder_draft', JSON.stringify(data));
        },
      });

      // Expose builder to window for debugging
      window.mailBuilder = builder;
      
      console.log('MailBuilder initialized successfully!');
      console.log('Access the builder instance via window.mailBuilder');
    }

    // Start the builder
    initBuilder();
  </script>
</body>
</html>
